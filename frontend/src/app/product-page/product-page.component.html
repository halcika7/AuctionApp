<app-breadcrumb
  [title]="'single product'"
  [other]="[{ value: 'shop /', link: '/shop' }, { value: 'single product', link: '' }]"
></app-breadcrumb>

<app-alert *ngIf="message" [message]="message" [type]="false" [closable]="false"></app-alert>
<app-alert
  *ngIf="successMessage"
  [message]="successMessage"
  [type]="true"
  [closable]="true"
  (closeAlert)="clearMessages()"
></app-alert>
<app-alert
  *ngIf="failedMessage"
  [message]="failedMessage"
  [gold]="true"
  [closable]="true"
  (closeAlert)="clearMessages()"
></app-alert>

<section class="about-product container">
  <app-product-images></app-product-images>
  <div class="details">
    <h2>{{ product.name }}</h2>
    <h4>Start from - {{ product.price | currency }}</h4>
    <form class="bid" *ngIf="!hide" #form (submit)="onSubmit(form.price)">
      <div class="wrap">
        <div class="input">
          <input
            type="number"
            [min]="noBids ? minPrice : minPrice + 0.1"
            step="0.1"
            placeholder="Enter bid"
            (change)="valueChange($event)"
            [value]="enteredPrice"
            name="price"
          />
          <span *ngIf="noBids">Enter {{ minPrice | currency }} or more</span>
          <span *ngIf="!noBids">Enter higher than {{ minPrice | currency }}</span>
        </div>
        <button class="bid-button" [disabled]="disabled">Place bid</button>
      </div>
    </form>
    <div class="current-bid">
      <ng-template [ngIf]="!hide">
        <p>
          Highest bid: <span>{{ product.highest_bid | currency }}</span>
        </p>
        <p>Number of bids: {{ product.number_of_bids }}</p>
        <p>Time: {{ product.auctionEnd | dateAgo: [{ agoOrLeft: 'left' }] }}</p>
        <p>
          Started:
          {{ product.auctionStart | dateAgo: [{ agoOrLeft: 'ago', response: 'Not started yet' }] }}
        </p>
      </ng-template>
      <p *ngIf="hide">
        Starts in:
        {{
          product.auctionStart
            | dateAgo
              : [{ agoOrLeft: 'left', response: 'Not started yet', loop: true, append: false }]
        }}
      </p>
    </div>
    <div class="watchlist">
      <button>Watchlist <fa-icon [icon]="['fas', 'heart']"></fa-icon></button>
    </div>
    <div class="product-details">
      <h5>Details</h5>
      <p>{{ product.details }}</p>
    </div>
  </div>
</section>

<app-landing-page-products
  title="Similar Products"
  className="feature-collection"
  [items]="similarProducts"
></app-landing-page-products>

<section class="container table-biders" *ngIf="userId === product.userId">
  <table class="biders">
    <thead>
      <tr>
        <th>Bider</th>
        <th>Date</th>
        <th>Bid</th>
      </tr>
    </thead>
    <tbody *ngIf="bids.length > 0">
      <tr *ngFor="let bid of bids; let index = index">
        <td>
          <div class="user">
            <img [src]="bid.User.photo" alt="" />
            <span>{{ bid.User.firstName }} {{ bid.User.lastName }}</span>
          </div>
        </td>
        <td>{{ bid.dateBid | date: 'd MMMM y' }}</td>
        <td [ngClass]="{ highest: index === 0, second: index === 1, third: index === 2 }">
          {{ bid.price | currency }}
        </td>
      </tr>
    </tbody>
  </table>
  <p *ngIf="bids.length === 0">No bids...</p>
</section>
